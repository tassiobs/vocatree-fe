{"ast":null,"code":"var _jsxFileName = \"/Users/tassiobs/Documents/vocatree-fe/src/components/FolderView.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { TreeNode } from './TreeNode';\nimport { AddItemInput } from './AddItemInput';\nimport { AICardForm } from './AICardForm';\nimport { DropdownMenu, createEditAction, createDeleteAction, createAICardAction } from './DropdownMenu';\nimport { handleConditionalDelete } from '../utils/deleteUtils';\nimport { MoveToModal } from './MoveToModal';\nimport { X, Folder, Loader2, FileText, Plus, Check, Move } from 'lucide-react';\nimport { apiClient } from '../services/api';\nimport { cardToTreeItem } from '../utils/treeUtils';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const FolderView = ({\n  folder,\n  onClose,\n  onRename,\n  onDelete,\n  onMove,\n  onRefresh,\n  categories = []\n}) => {\n  _s();\n  const [folderData, setFolderData] = useState(folder);\n  const [isLoading, setIsLoading] = useState(false);\n  const [expandedIds, setExpandedIds] = useState(new Set());\n  const [isEditing, setIsEditing] = useState(false);\n  const [editName, setEditName] = useState(folder.name);\n  const [showAddInput, setShowAddInput] = useState(false);\n  const [addType, setAddType] = useState('card');\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [showAICardForm, setShowAICardForm] = useState(false);\n  const [showMoveToModal, setShowMoveToModal] = useState(false);\n  const [showPracticeSession, setShowPracticeSession] = useState(false);\n  const isRootFolder = folder.parent_id === null;\n  useEffect(() => {\n    loadFolderData();\n  }, [folder.id]);\n\n  // Sync editName with folder.name when folder changes\n  useEffect(() => {\n    if (!isEditing) {\n      setEditName(folderData.name);\n    }\n  }, [folderData.name, isEditing]);\n  const loadFolderData = async () => {\n    try {\n      setIsLoading(true);\n      // Get the folder's direct children\n      const response = await apiClient.getCardsByParent(folder.id);\n      const children = response.items.map(card => cardToTreeItem(card));\n      setFolderData({\n        ...folder,\n        children: children\n      });\n    } catch (err) {\n      console.error('Error loading folder data:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const handleToggle = id => {\n    setExpandedIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n\n      // Update the tree items with new expansion state\n      const updateTreeExpansion = items => {\n        return items.map(item => ({\n          ...item,\n          isExpanded: newSet.has(item.id),\n          children: item.children ? updateTreeExpansion(item.children) : []\n        }));\n      };\n      setFolderData(prev => ({\n        ...prev,\n        children: updateTreeExpansion(prev.children)\n      }));\n      return newSet;\n    });\n  };\n  const handleAddChildToFolder = async (parentId, type, name) => {\n    try {\n      await apiClient.createCard({\n        name,\n        parent_id: parentId,\n        is_folder: type === 'folder',\n        category_id: folder.category_id\n      });\n\n      // Refresh the folder data\n      await loadFolderData();\n      if (onRefresh) {\n        onRefresh();\n      }\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error('Error adding child to folder:', err);\n      const errorMessage = err.message || ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.detail) || 'Failed to add item';\n      alert(`Failed to add item: ${errorMessage}`);\n    }\n  };\n  const handleRename = async () => {\n    if (!editName.trim()) {\n      setEditName(folderData.name);\n      setIsEditing(false);\n      return;\n    }\n    if (editName.trim() === folderData.name) {\n      setIsEditing(false);\n      return;\n    }\n    try {\n      setIsSaving(true);\n      await apiClient.updateCard(folderData.id, {\n        name: editName.trim()\n      });\n      onRename(folderData.id, editName.trim());\n      setFolderData({\n        ...folderData,\n        name: editName.trim()\n      });\n      setIsEditing(false);\n      if (onRefresh) {\n        onRefresh();\n      }\n    } catch (err) {\n      console.error('Error renaming folder:', err);\n      setEditName(folderData.name);\n      alert('Failed to rename folder. Please try again.');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n  const handleCancelEdit = () => {\n    setEditName(folderData.name);\n    setIsEditing(false);\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleRename();\n    } else if (e.key === 'Escape') {\n      handleCancelEdit();\n    }\n  };\n  const handleBlur = e => {\n    const relatedTarget = e.relatedTarget;\n    if (relatedTarget && (relatedTarget.closest('.edit-actions') || relatedTarget.closest('button'))) {\n      return;\n    }\n    setTimeout(() => {\n      if (isEditing) {\n        handleRename();\n      }\n    }, 200);\n  };\n  const handleDelete = async () => {\n    try {\n      setIsDeleting(true);\n      await handleConditionalDelete(folderData, () => {\n        onDelete(folderData.id);\n        onClose();\n      }, error => {\n        console.error('Error deleting folder:', error);\n        alert('Failed to delete folder');\n      });\n    } finally {\n      setIsDeleting(false);\n    }\n  };\n  const handleAddChild = async name => {\n    try {\n      await apiClient.createCard({\n        name,\n        parent_id: folderData.id,\n        is_folder: addType === 'folder',\n        category_id: folderData.category_id\n      });\n      await loadFolderData();\n      setShowAddInput(false);\n      if (onRefresh) {\n        onRefresh();\n      }\n    } catch (err) {\n      console.error('Error adding child:', err);\n      alert('Failed to add item');\n    }\n  };\n  const handleAddFolder = () => {\n    setAddType('folder');\n    setShowAddInput(true);\n  };\n  const handleAddCard = () => {\n    setAddType('card');\n    setShowAddInput(true);\n  };\n  const handleAICardSuccess = cardId => {\n    setShowAICardForm(false);\n    loadFolderData();\n    if (onRefresh) {\n      onRefresh();\n    }\n  };\n\n  // Create dropdown menu items for folder\n  const getFolderDropdownItems = () => {\n    const items = [createEditAction(() => setIsEditing(true)), {\n      id: 'move',\n      label: 'Move To...',\n      icon: /*#__PURE__*/_jsxDEV(Move, {\n        className: \"h-4 w-4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 15\n      }, this),\n      onClick: () => setShowMoveToModal(true)\n    }, createDeleteAction(handleDelete), createAICardAction(() => setShowAICardForm(true))];\n    return items;\n  };\n\n  // Count items\n  const totalItems = folderData.children.length;\n  const folderCount = folderData.children.filter(child => child.is_folder).length;\n  const cardCount = folderData.children.filter(child => !child.is_folder).length;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3 flex-1 min-w-0\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-2 bg-blue-100 rounded-lg flex-shrink-0\",\n            children: /*#__PURE__*/_jsxDEV(Folder, {\n              className: \"h-5 w-5 sm:h-6 sm:w-6 text-blue-600\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 min-w-0\",\n            children: isEditing ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: editName,\n                onChange: e => setEditName(e.target.value),\n                onBlur: handleBlur,\n                onKeyDown: handleKeyDown,\n                className: \"flex-1 border border-blue-300 rounded-md px-3 py-1 text-lg sm:text-xl font-bold bg-white text-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500\",\n                autoFocus: true,\n                disabled: isSaving\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"edit-actions flex items-center space-x-1\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handleRename,\n                  disabled: isSaving || !editName.trim(),\n                  className: \"p-1.5 hover:bg-green-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\",\n                  title: \"Save\",\n                  children: /*#__PURE__*/_jsxDEV(Check, {\n                    className: \"h-5 w-5 text-green-600\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 288,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 282,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handleCancelEdit,\n                  disabled: isSaving,\n                  className: \"p-1.5 hover:bg-red-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\",\n                  title: \"Cancel\",\n                  children: /*#__PURE__*/_jsxDEV(X, {\n                    className: \"h-5 w-5 text-red-600\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 296,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 290,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"text-lg sm:text-xl font-bold text-blue-900 truncate\",\n                children: folderData.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 302,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex flex-wrap items-center gap-2 sm:gap-4 mt-1\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-xs sm:text-sm text-blue-600\",\n                  children: [totalItems, \" \", totalItems === 1 ? 'item' : 'items']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 306,\n                  columnNumber: 21\n                }, this), folderCount > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-xs sm:text-sm text-blue-600 flex items-center\",\n                  children: [/*#__PURE__*/_jsxDEV(Folder, {\n                    className: \"h-3 w-3 mr-1\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 311,\n                    columnNumber: 25\n                  }, this), folderCount, \" \", folderCount === 1 ? 'folder' : 'folders']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 310,\n                  columnNumber: 23\n                }, this), cardCount > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-xs sm:text-sm text-blue-600 flex items-center\",\n                  children: [/*#__PURE__*/_jsxDEV(FileText, {\n                    className: \"h-3 w-3 mr-1\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 317,\n                    columnNumber: 25\n                  }, this), cardCount, \" \", cardCount === 1 ? 'card' : 'cards']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 316,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 305,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this), !isEditing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2 mr-2\",\n          children: [isRootFolder && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleAddFolder,\n            className: \"p-2 hover:bg-blue-100 rounded-lg bg-blue-50 transition-colors\",\n            title: \"Add subfolder\",\n            children: /*#__PURE__*/_jsxDEV(Folder, {\n              className: \"h-4 w-4 text-blue-600\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 336,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 331,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleAddCard,\n            className: \"p-2 hover:bg-gray-200 rounded-lg bg-gray-100 transition-colors\",\n            title: \"Add card\",\n            children: /*#__PURE__*/_jsxDEV(Plus, {\n              className: \"h-4 w-4 text-gray-700\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 13\n        }, this), !isEditing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mr-2\",\n          children: /*#__PURE__*/_jsxDEV(DropdownMenu, {\n            items: getFolderDropdownItems(),\n            className: \"opacity-100\",\n            disabled: isDeleting\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"p-2 hover:bg-blue-100 rounded-lg transition-colors flex-shrink-0 ml-2\",\n          title: \"Close\",\n          children: /*#__PURE__*/_jsxDEV(X, {\n            className: \"h-5 w-5 text-blue-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this), showAddInput && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"px-4 sm:px-6 py-4 bg-gray-50 border-b border-gray-100\",\n        children: /*#__PURE__*/_jsxDEV(AddItemInput, {\n          parentId: folderData.id,\n          type: addType,\n          onSubmit: handleAddChild,\n          onCancel: () => setShowAddInput(false),\n          placeholder: `Add ${addType}...`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto p-4 sm:p-6\",\n        children: isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-center py-12\",\n          children: [/*#__PURE__*/_jsxDEV(Loader2, {\n            className: \"h-6 w-6 animate-spin text-blue-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"ml-2 text-gray-600\",\n            children: \"Loading folder...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 387,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 13\n        }, this) : folderData.children.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col items-center justify-center py-12 text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(Folder, {\n            className: \"h-12 w-12 mb-4 opacity-50\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-medium mb-2\",\n            children: \"No items in this folder\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-center mb-4\",\n            children: isRootFolder ? 'Add subfolders or cards to get started' : 'Add cards to get started'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 393,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-center space-x-2\",\n            children: [isRootFolder && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleAddFolder,\n              className: \"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors\",\n              children: \"Add Subfolder\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleAddCard,\n              className: \"px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\",\n              children: \"Add Card\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-2\",\n          children: folderData.children.map(item => /*#__PURE__*/_jsxDEV(TreeNode, {\n            item: item,\n            onToggle: handleToggle,\n            onRename: onRename,\n            onDelete: onDelete,\n            onAddChild: handleAddChildToFolder,\n            onMove: onMove,\n            level: 0,\n            categoryId: folder.category_id,\n            categories: categories\n          }, item.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 383,\n        columnNumber: 9\n      }, this), showAICardForm && /*#__PURE__*/_jsxDEV(AICardForm, {\n        parentId: folderData.id,\n        parentName: folderData.name,\n        onClose: () => setShowAICardForm(false),\n        onSuccess: handleAICardSuccess\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 11\n      }, this), showMoveToModal && categories.length > 0 && /*#__PURE__*/_jsxDEV(MoveToModal, {\n        item: folderData,\n        categories: categories,\n        onClose: () => setShowMoveToModal(false),\n        onMove: onMove\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 260,\n    columnNumber: 5\n  }, this);\n};\n_s(FolderView, \"Wn/d6Q4uSycAbnbO+mXJufg7KAE=\");\n_c = FolderView;\nvar _c;\n$RefreshReg$(_c, \"FolderView\");","map":{"version":3,"names":["React","useState","useEffect","TreeNode","AddItemInput","AICardForm","DropdownMenu","createEditAction","createDeleteAction","createAICardAction","handleConditionalDelete","MoveToModal","X","Folder","Loader2","FileText","Plus","Check","Move","apiClient","cardToTreeItem","jsxDEV","_jsxDEV","Fragment","_Fragment","FolderView","folder","onClose","onRename","onDelete","onMove","onRefresh","categories","_s","folderData","setFolderData","isLoading","setIsLoading","expandedIds","setExpandedIds","Set","isEditing","setIsEditing","editName","setEditName","name","showAddInput","setShowAddInput","addType","setAddType","isDeleting","setIsDeleting","isSaving","setIsSaving","showAICardForm","setShowAICardForm","showMoveToModal","setShowMoveToModal","showPracticeSession","setShowPracticeSession","isRootFolder","parent_id","loadFolderData","id","response","getCardsByParent","children","items","map","card","err","console","error","handleToggle","prev","newSet","has","delete","add","updateTreeExpansion","item","isExpanded","handleAddChildToFolder","parentId","type","createCard","is_folder","category_id","_err$response","_err$response$data","errorMessage","message","data","detail","alert","handleRename","trim","updateCard","handleCancelEdit","handleKeyDown","e","key","preventDefault","handleBlur","relatedTarget","closest","setTimeout","handleDelete","handleAddChild","handleAddFolder","handleAddCard","handleAICardSuccess","cardId","getFolderDropdownItems","label","icon","className","fileName","_jsxFileName","lineNumber","columnNumber","onClick","totalItems","length","folderCount","filter","child","cardCount","value","onChange","target","onBlur","onKeyDown","autoFocus","disabled","title","onSubmit","onCancel","placeholder","onToggle","onAddChild","level","categoryId","parentName","onSuccess","_c","$RefreshReg$"],"sources":["/Users/tassiobs/Documents/vocatree-fe/src/components/FolderView.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { TreeItem, CategoryItem } from '../types';\nimport { TreeNode } from './TreeNode';\nimport { AddItemInput } from './AddItemInput';\nimport { AICardForm } from './AICardForm';\nimport { DropdownMenu, DropdownMenuItem, createEditAction, createDeleteAction, createAICardAction, createPracticeFolderAction } from './DropdownMenu';\nimport { FolderPracticeSession } from './FolderPracticeSession';\nimport { handleConditionalDelete } from '../utils/deleteUtils';\nimport { MoveToModal } from './MoveToModal';\nimport { X, Folder, Loader2, FileText, Plus, Check, Move } from 'lucide-react';\nimport { apiClient } from '../services/api';\nimport { Card } from '../types/api';\nimport { cardToTreeItem } from '../utils/treeUtils';\n\ninterface FolderViewProps {\n  folder: TreeItem;\n  onClose: () => void;\n  onRename: (id: number, newName: string) => void;\n  onDelete: (id: number) => void;\n  onMove: (itemId: number, data: { parent_id?: number | null; category_id?: number | null }) => Promise<void>;\n  onRefresh?: () => void;\n  categories?: CategoryItem[];\n}\n\nexport const FolderView: React.FC<FolderViewProps> = ({\n  folder,\n  onClose,\n  onRename,\n  onDelete,\n  onMove,\n  onRefresh,\n  categories = [],\n}) => {\n  const [folderData, setFolderData] = useState<TreeItem>(folder);\n  const [isLoading, setIsLoading] = useState(false);\n  const [expandedIds, setExpandedIds] = useState<Set<number>>(new Set());\n  const [isEditing, setIsEditing] = useState(false);\n  const [editName, setEditName] = useState(folder.name);\n  const [showAddInput, setShowAddInput] = useState(false);\n  const [addType, setAddType] = useState<'folder' | 'card'>('card');\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [showAICardForm, setShowAICardForm] = useState(false);\n  const [showMoveToModal, setShowMoveToModal] = useState(false);\n  const [showPracticeSession, setShowPracticeSession] = useState(false);\n  const isRootFolder = folder.parent_id === null;\n\n  useEffect(() => {\n    loadFolderData();\n  }, [folder.id]);\n\n  // Sync editName with folder.name when folder changes\n  useEffect(() => {\n    if (!isEditing) {\n      setEditName(folderData.name);\n    }\n  }, [folderData.name, isEditing]);\n\n  const loadFolderData = async () => {\n    try {\n      setIsLoading(true);\n      // Get the folder's direct children\n      const response = await apiClient.getCardsByParent(folder.id);\n      const children: TreeItem[] = response.items.map((card: Card) => cardToTreeItem(card));\n      \n      setFolderData({\n        ...folder,\n        children: children,\n      });\n    } catch (err: any) {\n      console.error('Error loading folder data:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleToggle = (id: number) => {\n    setExpandedIds((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      \n      // Update the tree items with new expansion state\n      const updateTreeExpansion = (items: TreeItem[]): TreeItem[] => {\n        return items.map((item) => ({\n          ...item,\n          isExpanded: newSet.has(item.id),\n          children: item.children ? updateTreeExpansion(item.children) : [],\n        }));\n      };\n      \n      setFolderData((prev) => ({\n        ...prev,\n        children: updateTreeExpansion(prev.children),\n      }));\n      \n      return newSet;\n    });\n  };\n\n  const handleAddChildToFolder = async (parentId: number, type: 'folder' | 'card', name: string) => {\n    try {\n      await apiClient.createCard({\n        name,\n        parent_id: parentId,\n        is_folder: type === 'folder',\n        category_id: folder.category_id,\n      });\n\n      // Refresh the folder data\n      await loadFolderData();\n      if (onRefresh) {\n        onRefresh();\n      }\n    } catch (err: any) {\n      console.error('Error adding child to folder:', err);\n      const errorMessage = err.message || err.response?.data?.detail || 'Failed to add item';\n      alert(`Failed to add item: ${errorMessage}`);\n    }\n  };\n\n  const handleRename = async () => {\n    if (!editName.trim()) {\n      setEditName(folderData.name);\n      setIsEditing(false);\n      return;\n    }\n\n    if (editName.trim() === folderData.name) {\n      setIsEditing(false);\n      return;\n    }\n\n    try {\n      setIsSaving(true);\n      await apiClient.updateCard(folderData.id, { name: editName.trim() });\n      onRename(folderData.id, editName.trim());\n      setFolderData({ ...folderData, name: editName.trim() });\n      setIsEditing(false);\n      if (onRefresh) {\n        onRefresh();\n      }\n    } catch (err: any) {\n      console.error('Error renaming folder:', err);\n      setEditName(folderData.name);\n      alert('Failed to rename folder. Please try again.');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setEditName(folderData.name);\n    setIsEditing(false);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleRename();\n    } else if (e.key === 'Escape') {\n      handleCancelEdit();\n    }\n  };\n\n  const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    const relatedTarget = e.relatedTarget as HTMLElement;\n    if (relatedTarget && (relatedTarget.closest('.edit-actions') || relatedTarget.closest('button'))) {\n      return;\n    }\n    setTimeout(() => {\n      if (isEditing) {\n        handleRename();\n      }\n    }, 200);\n  };\n\n  const handleDelete = async () => {\n    try {\n      setIsDeleting(true);\n      await handleConditionalDelete(\n        folderData,\n        () => {\n          onDelete(folderData.id);\n          onClose();\n        },\n        (error) => {\n          console.error('Error deleting folder:', error);\n          alert('Failed to delete folder');\n        }\n      );\n    } finally {\n      setIsDeleting(false);\n    }\n  };\n\n  const handleAddChild = async (name: string) => {\n    try {\n      await apiClient.createCard({\n        name,\n        parent_id: folderData.id,\n        is_folder: addType === 'folder',\n        category_id: folderData.category_id,\n      });\n\n      await loadFolderData();\n      setShowAddInput(false);\n      if (onRefresh) {\n        onRefresh();\n      }\n    } catch (err: any) {\n      console.error('Error adding child:', err);\n      alert('Failed to add item');\n    }\n  };\n\n  const handleAddFolder = () => {\n    setAddType('folder');\n    setShowAddInput(true);\n  };\n\n  const handleAddCard = () => {\n    setAddType('card');\n    setShowAddInput(true);\n  };\n\n  const handleAICardSuccess = (cardId: number) => {\n    setShowAICardForm(false);\n    loadFolderData();\n    if (onRefresh) {\n      onRefresh();\n    }\n  };\n\n  // Create dropdown menu items for folder\n  const getFolderDropdownItems = (): DropdownMenuItem[] => {\n    const items: DropdownMenuItem[] = [\n      createEditAction(() => setIsEditing(true)),\n      {\n        id: 'move',\n        label: 'Move To...',\n        icon: <Move className=\"h-4 w-4\" />,\n        onClick: () => setShowMoveToModal(true),\n      },\n      createDeleteAction(handleDelete),\n      createAICardAction(() => setShowAICardForm(true)),\n    ];\n    return items;\n  };\n\n  // Count items\n  const totalItems = folderData.children.length;\n  const folderCount = folderData.children.filter(child => child.is_folder).length;\n  const cardCount = folderData.children.filter(child => !child.is_folder).length;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50\">\n          <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\n            <div className=\"p-2 bg-blue-100 rounded-lg flex-shrink-0\">\n              <Folder className=\"h-5 w-5 sm:h-6 sm:w-6 text-blue-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              {isEditing ? (\n                <div className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"text\"\n                    value={editName}\n                    onChange={(e) => setEditName(e.target.value)}\n                    onBlur={handleBlur}\n                    onKeyDown={handleKeyDown}\n                    className=\"flex-1 border border-blue-300 rounded-md px-3 py-1 text-lg sm:text-xl font-bold bg-white text-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    autoFocus\n                    disabled={isSaving}\n                  />\n                  <div className=\"edit-actions flex items-center space-x-1\">\n                    <button\n                      onClick={handleRename}\n                      disabled={isSaving || !editName.trim()}\n                      className=\"p-1.5 hover:bg-green-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      title=\"Save\"\n                    >\n                      <Check className=\"h-5 w-5 text-green-600\" />\n                    </button>\n                    <button\n                      onClick={handleCancelEdit}\n                      disabled={isSaving}\n                      className=\"p-1.5 hover:bg-red-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      title=\"Cancel\"\n                    >\n                      <X className=\"h-5 w-5 text-red-600\" />\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <>\n                  <h2 className=\"text-lg sm:text-xl font-bold text-blue-900 truncate\">\n                    {folderData.name}\n                  </h2>\n                  <div className=\"flex flex-wrap items-center gap-2 sm:gap-4 mt-1\">\n                    <p className=\"text-xs sm:text-sm text-blue-600\">\n                      {totalItems} {totalItems === 1 ? 'item' : 'items'}\n                    </p>\n                    {folderCount > 0 && (\n                      <p className=\"text-xs sm:text-sm text-blue-600 flex items-center\">\n                        <Folder className=\"h-3 w-3 mr-1\" />\n                        {folderCount} {folderCount === 1 ? 'folder' : 'folders'}\n                      </p>\n                    )}\n                    {cardCount > 0 && (\n                      <p className=\"text-xs sm:text-sm text-blue-600 flex items-center\">\n                        <FileText className=\"h-3 w-3 mr-1\" />\n                        {cardCount} {cardCount === 1 ? 'card' : 'cards'}\n                      </p>\n                    )}\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n          \n          {/* Add buttons */}\n          {!isEditing && (\n            <div className=\"flex items-center space-x-2 mr-2\">\n              {isRootFolder && (\n                <button\n                  onClick={handleAddFolder}\n                  className=\"p-2 hover:bg-blue-100 rounded-lg bg-blue-50 transition-colors\"\n                  title=\"Add subfolder\"\n                >\n                  <Folder className=\"h-4 w-4 text-blue-600\" />\n                </button>\n              )}\n              <button\n                onClick={handleAddCard}\n                className=\"p-2 hover:bg-gray-200 rounded-lg bg-gray-100 transition-colors\"\n                title=\"Add card\"\n              >\n                <Plus className=\"h-4 w-4 text-gray-700\" />\n              </button>\n            </div>\n          )}\n\n          {/* Actions dropdown menu */}\n          {!isEditing && (\n            <div className=\"mr-2\">\n              <DropdownMenu\n                items={getFolderDropdownItems()}\n                className=\"opacity-100\"\n                disabled={isDeleting}\n              />\n            </div>\n          )}\n\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-blue-100 rounded-lg transition-colors flex-shrink-0 ml-2\"\n            title=\"Close\"\n          >\n            <X className=\"h-5 w-5 text-blue-600\" />\n          </button>\n        </div>\n\n        {/* Add item input */}\n        {showAddInput && (\n          <div className=\"px-4 sm:px-6 py-4 bg-gray-50 border-b border-gray-100\">\n            <AddItemInput\n              parentId={folderData.id}\n              type={addType}\n              onSubmit={handleAddChild}\n              onCancel={() => setShowAddInput(false)}\n              placeholder={`Add ${addType}...`}\n            />\n          </div>\n        )}\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-4 sm:p-6\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-blue-600\" />\n              <span className=\"ml-2 text-gray-600\">Loading folder...</span>\n            </div>\n          ) : folderData.children.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-gray-500\">\n              <Folder className=\"h-12 w-12 mb-4 opacity-50\" />\n              <p className=\"text-lg font-medium mb-2\">No items in this folder</p>\n              <p className=\"text-sm text-center mb-4\">\n                {isRootFolder ? 'Add subfolders or cards to get started' : 'Add cards to get started'}\n              </p>\n              <div className=\"flex items-center justify-center space-x-2\">\n                {isRootFolder && (\n                  <button\n                    onClick={handleAddFolder}\n                    className=\"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors\"\n                  >\n                    Add Subfolder\n                  </button>\n                )}\n                <button\n                  onClick={handleAddCard}\n                  className=\"px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\n                >\n                  Add Card\n                </button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"space-y-2\">\n              {folderData.children.map((item) => (\n                <TreeNode\n                  key={item.id}\n                  item={item}\n                  onToggle={handleToggle}\n                  onRename={onRename}\n                  onDelete={onDelete}\n                  onAddChild={handleAddChildToFolder}\n                  onMove={onMove}\n                  level={0}\n                  categoryId={folder.category_id}\n                  categories={categories}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* AI Card Form Modal */}\n        {showAICardForm && (\n          <AICardForm\n            parentId={folderData.id}\n            parentName={folderData.name}\n            onClose={() => setShowAICardForm(false)}\n            onSuccess={handleAICardSuccess}\n          />\n        )}\n\n        {/* Move To Modal */}\n        {showMoveToModal && categories.length > 0 && (\n          <MoveToModal\n            item={folderData}\n            categories={categories}\n            onClose={() => setShowMoveToModal(false)}\n            onMove={onMove}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}