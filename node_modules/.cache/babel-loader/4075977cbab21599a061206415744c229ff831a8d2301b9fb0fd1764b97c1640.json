{"ast":null,"code":"import{apiClient}from'../services/api';/**\n * Check if a tree item has children (cards or folders)\n */export const hasChildren=item=>{return item.children&&item.children.length>0;};/**\n * Get the count of children for a tree item\n */export const getChildrenCount=item=>{return item.children?item.children.length:0;};/**\n * Handle conditional delete for a tree item\n * Shows appropriate confirmation message based on whether the item has children\n */export const handleConditionalDelete=async(item,onSuccess,onError)=>{const deleteId=Math.random().toString(36).substr(2,9);console.log(\"[\".concat(deleteId,\"] Starting delete process for item \").concat(item.id,\" (\").concat(item.name,\")\"));const hasChildItems=hasChildren(item);const childrenCount=getChildrenCount(item);let confirmMessage;if(hasChildItems){var _item$children,_item$children2;const folderCount=((_item$children=item.children)===null||_item$children===void 0?void 0:_item$children.filter(child=>child.is_folder).length)||0;const cardCount=((_item$children2=item.children)===null||_item$children2===void 0?void 0:_item$children2.filter(child=>!child.is_folder).length)||0;let itemDescription='';if(folderCount>0&&cardCount>0){itemDescription=\"\".concat(folderCount,\" folder\").concat(folderCount===1?'':'s',\" and \").concat(cardCount,\" card\").concat(cardCount===1?'':'s');}else if(folderCount>0){itemDescription=\"\".concat(folderCount,\" folder\").concat(folderCount===1?'':'s');}else{itemDescription=\"\".concat(cardCount,\" card\").concat(cardCount===1?'':'s');}confirmMessage=\"This \".concat(item.is_folder?'folder':'category',\" contains \").concat(itemDescription,\". Deleting it will also delete all items inside. Do you want to continue?\");}else{confirmMessage=\"Are you sure you want to delete this \".concat(item.is_folder?'folder':'card',\"?\");}const confirmed=window.confirm(confirmMessage);if(!confirmed){return;}try{console.log('Delete item details:',{id:item.id,name:item.name,is_folder:item.is_folder,parent_id:item.parent_id,hasChildren:hasChildItems,isCategory:item.isCategory});if(item.isCategory){// This is a category - use category bulk delete endpoint\nconsole.log(\"[\".concat(deleteId,\"] Deleting category with bulk delete:\"),item.id,item.name);await apiClient.bulkDeleteCategory(item.id);}else if(hasChildItems){// This is a folder with children - use card bulk delete endpoint\nconsole.log(\"[\".concat(deleteId,\"] Deleting folder with children using card bulk delete:\"),item.id,item.name);await apiClient.deleteCardBulk(item.id);}else{// This is a card or folder without children - use standard delete endpoint\nconsole.log(\"[\".concat(deleteId,\"] Deleting \").concat(item.is_folder?'folder':'card',\" without children using standard delete:\"),item.id,item.name);await apiClient.deleteCard(item.id);}console.log(\"[\".concat(deleteId,\"] Delete successful for item \").concat(item.id,\", calling onSuccess\"));onSuccess();}catch(error){var _error$response,_error$response2,_error$response2$data;console.error('Error deleting item:',error);// Handle specific error cases\nif((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===404){// Item not found - might have been deleted already\nconsole.warn(\"Item \".concat(item.id,\" not found, might have been deleted already\"));// Still call onSuccess to update the UI since the item is effectively gone\nonSuccess();return;}// Handle the specific \"already deleted\" error from backend\nconst errorMessage=(error===null||error===void 0?void 0:(_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.detail)||(error===null||error===void 0?void 0:error.message)||'Unknown error occurred';if(errorMessage.includes('has been deleted')||errorMessage.includes('not present')){console.warn(\"Item \".concat(item.id,\" appears to have been deleted already:\"),errorMessage);// Still call onSuccess to update the UI since the item is effectively gone\nonSuccess();return;}if(onError){onError(error);}else{var _error$response3;const statusCode=error===null||error===void 0?void 0:(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status;if(statusCode===404){alert(\"The \".concat(item.is_folder?'folder':'card',\" was not found. It may have been deleted already.\"));}else{alert(\"Failed to delete \".concat(item.is_folder?'folder':'card',\": \").concat(errorMessage));}}}};","map":{"version":3,"names":["apiClient","hasChildren","item","children","length","getChildrenCount","handleConditionalDelete","onSuccess","onError","deleteId","Math","random","toString","substr","console","log","concat","id","name","hasChildItems","childrenCount","confirmMessage","_item$children","_item$children2","folderCount","filter","child","is_folder","cardCount","itemDescription","confirmed","window","confirm","parent_id","isCategory","bulkDeleteCategory","deleteCardBulk","deleteCard","error","_error$response","_error$response2","_error$response2$data","response","status","warn","errorMessage","data","detail","message","includes","_error$response3","statusCode","alert"],"sources":["/Users/tassiobs/Documents/vocatree-fe/src/utils/deleteUtils.ts"],"sourcesContent":["import { TreeItem } from '../types';\nimport { apiClient } from '../services/api';\n\n/**\n * Check if a tree item has children (cards or folders)\n */\nexport const hasChildren = (item: TreeItem): boolean => {\n  return item.children && item.children.length > 0;\n};\n\n/**\n * Get the count of children for a tree item\n */\nexport const getChildrenCount = (item: TreeItem): number => {\n  return item.children ? item.children.length : 0;\n};\n\n\n/**\n * Handle conditional delete for a tree item\n * Shows appropriate confirmation message based on whether the item has children\n */\nexport const handleConditionalDelete = async (\n  item: TreeItem,\n  onSuccess: () => void,\n  onError?: (error: any) => void\n): Promise<void> => {\n  const deleteId = Math.random().toString(36).substr(2, 9);\n  console.log(`[${deleteId}] Starting delete process for item ${item.id} (${item.name})`);\n  \n  const hasChildItems = hasChildren(item);\n  const childrenCount = getChildrenCount(item);\n  \n  let confirmMessage: string;\n  \n  if (hasChildItems) {\n    const folderCount = item.children?.filter(child => child.is_folder).length || 0;\n    const cardCount = item.children?.filter(child => !child.is_folder).length || 0;\n    \n    let itemDescription = '';\n    if (folderCount > 0 && cardCount > 0) {\n      itemDescription = `${folderCount} folder${folderCount === 1 ? '' : 's'} and ${cardCount} card${cardCount === 1 ? '' : 's'}`;\n    } else if (folderCount > 0) {\n      itemDescription = `${folderCount} folder${folderCount === 1 ? '' : 's'}`;\n    } else {\n      itemDescription = `${cardCount} card${cardCount === 1 ? '' : 's'}`;\n    }\n    \n    confirmMessage = `This ${item.is_folder ? 'folder' : 'category'} contains ${itemDescription}. Deleting it will also delete all items inside. Do you want to continue?`;\n  } else {\n    confirmMessage = `Are you sure you want to delete this ${item.is_folder ? 'folder' : 'card'}?`;\n  }\n\n  const confirmed = window.confirm(confirmMessage);\n  \n  if (!confirmed) {\n    return;\n  }\n\n  try {\n    console.log('Delete item details:', {\n      id: item.id,\n      name: item.name,\n      is_folder: item.is_folder,\n      parent_id: item.parent_id,\n      hasChildren: hasChildItems,\n      isCategory: item.isCategory\n    });\n    \n    if (item.isCategory) {\n      // This is a category - use category bulk delete endpoint\n      console.log(`[${deleteId}] Deleting category with bulk delete:`, item.id, item.name);\n      await apiClient.bulkDeleteCategory(item.id);\n    } else if (hasChildItems) {\n      // This is a folder with children - use card bulk delete endpoint\n      console.log(`[${deleteId}] Deleting folder with children using card bulk delete:`, item.id, item.name);\n      await apiClient.deleteCardBulk(item.id);\n    } else {\n      // This is a card or folder without children - use standard delete endpoint\n      console.log(`[${deleteId}] Deleting ${item.is_folder ? 'folder' : 'card'} without children using standard delete:`, item.id, item.name);\n      await apiClient.deleteCard(item.id);\n    }\n    console.log(`[${deleteId}] Delete successful for item ${item.id}, calling onSuccess`);\n    onSuccess();\n  } catch (error: any) {\n    console.error('Error deleting item:', error);\n    \n    // Handle specific error cases\n    if (error?.response?.status === 404) {\n      // Item not found - might have been deleted already\n      console.warn(`Item ${item.id} not found, might have been deleted already`);\n      // Still call onSuccess to update the UI since the item is effectively gone\n      onSuccess();\n      return;\n    }\n    \n    // Handle the specific \"already deleted\" error from backend\n    const errorMessage = error?.response?.data?.detail || error?.message || 'Unknown error occurred';\n    if (errorMessage.includes('has been deleted') || errorMessage.includes('not present')) {\n      console.warn(`Item ${item.id} appears to have been deleted already:`, errorMessage);\n      // Still call onSuccess to update the UI since the item is effectively gone\n      onSuccess();\n      return;\n    }\n    \n    if (onError) {\n      onError(error);\n    } else {\n      const statusCode = error?.response?.status;\n      \n      if (statusCode === 404) {\n        alert(`The ${item.is_folder ? 'folder' : 'card'} was not found. It may have been deleted already.`);\n      } else {\n        alert(`Failed to delete ${item.is_folder ? 'folder' : 'card'}: ${errorMessage}`);\n      }\n    }\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}